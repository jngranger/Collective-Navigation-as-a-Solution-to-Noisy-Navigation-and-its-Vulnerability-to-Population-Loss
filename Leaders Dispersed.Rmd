---
title: "Leaders Dispersed"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(readr)
library(ggplot2)
library(viridis)
directory="C:/Users/Jesse/Dropbox (Duke Bio_Ea)/Jesse/Duke/Research/Navigation Orientation/Flocking Model/Models and Code for Publication/"
source(paste0(directory,"/Cleaning Netlogo Function for Pub.R"))
```

Load the data and wrangle it into a useable format

```{r}
df=read_csv(paste0(directory,"Flocking Model_Leaders and Compounding Loss 4x weightnav and errornav and leaders-spreadsheet.csv"), col_names = F,skip = 6)

df_clean=clean_nlogo_lastonly_EndRunExport(df,reps = 3,num.variables = 2,
                                  p.max = 1,p.min = 0.1,p.by = 0.1,
                                  e.max=100,e.min=0,e.by=5,
                                  z.max=4,z.min=1,z.by=1,
                      num.things.varied = 4,
                      var.names = c("NumHomeLeaders","NumHomeFlockers"),
                 newcolnames = c("NavWeight","NavError","NumLeaders","run","coltype")) %>% 
  mutate(NumLeaders=replace(NumLeaders, NumLeaders==1, 400)) %>% 
  mutate(NumLeaders=replace(NumLeaders, NumLeaders==2, 1000)) %>% 
  mutate(NumLeaders=replace(NumLeaders, NumLeaders==3, 2000)) %>% 
  mutate(NumLeaders=replace(NumLeaders, NumLeaders==4, 3000))
```

Plotting the data

```{r,fig.width=10, fig.height=7}

df_clean2=df_clean %>%  
  group_by(NavWeight,NavError,NumLeaders) %>% 
  summarize(NumHomeLeaders=mean(NumHomeLeaders),NumHomeFlockers=mean(NumHomeFlockers),NumHome=NumHomeLeaders+NumHomeFlockers) %>% 
  ungroup() %>% 
  mutate(Leaders=(NumHomeLeaders/NumLeaders)*100,Flockers=(NumHomeFlockers/(4000-NumLeaders)*100),All=(NumHome/4000)*100) %>% 
  mutate(PercentLeaders=paste0((NumLeaders/4000)*100,"%")) %>% 
  gather(TypeHome,PercentHome,Leaders,Flockers,All)


(p=df_clean2 %>% 
    mutate(NavWeight=1-NavWeight) %>% #1 - Navweight = Flocking Weight 
ggplot()+
  scale_fill_viridis(direction = -1, name="% Home",limits=c(0,100))+
  facet_grid(TypeHome~PercentLeaders)+
  theme_classic()+
  scale_x_continuous(breaks=seq(0,1,0.2))+
  theme(
        strip.background = element_blank(),
        strip.text=element_text(size=10,face="bold"))+
   guides(fill = guide_colorbar(reverse=T))+
    geom_tile(aes(NavWeight,NavError,fill=PercentHome))+
    xlab("Leader's Reliance on Collective Navigation. 0=Asocial, 1=Only Flocking")+
    ylab("Leader's Nav. Error. 0=Perfect, 100=Noisy"))
  
#ggsave("Figure S1.png",p)
```



Maximum navigational error at which 70% of all agents make it back 

```{r}
df_clean2 %>% 
  filter(TypeHome=="All") %>% 
  filter(NumHome<=2800) %>% 
  group_by(PercentLeaders) %>% 
  filter(PercentHome==max(PercentHome)) %>% 
  
  arrange(desc(NumLeaders))
  
```









