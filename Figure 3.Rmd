---
title: "Figure 2"
author: "jng29"
date: "2/8/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(ggplot2)
library(viridis)
library(cowplot)

directory="C:/Users/Jesse/Dropbox (Duke Bio_Ea)/Jesse/Duke/Research/Navigation Orientation/Flocking Model/Models and Code for Publication/"
source(paste0(directory,"/Cleaning Netlogo Function for Pub.R"))
```


# Flocking

Load data and wrangle into a usable format

```{r}
df_4x=read_csv(paste0(directory,"Flocking Model_Base Model and Pop Loss 4x weightnav and errornav-spreadsheet.csv"), col_names = F,skip = 6)

df4x_clean=clean_nlogo_lastonly_EndRunExport(df_4x,reps=5,num.variables = 1,
                                    p.max=1,p.min=.1,p.by=.05,num.things.varied = 3,
                                    e.max=100,e.min=0,e.by=5,
                                    var.names = c("NumHome"),
                                    newcolnames =c("NavWeight","NavError","run","coltype")) %>% 
mutate(Pop = rep(4000)) %>%
mutate(NumHome=(NumHome/Pop)*100)

```

Plot and save the plot and legend separately

```{r}
(p.legend=df4x_clean %>% 
  group_by(NavWeight,NavError) %>% 
  summarize(NumHome=mean(NumHome)) %>% 
  mutate(NavWeight=1-NavWeight) %>% #1 - Navweight = Flocking Weight 
ggplot()+
  geom_tile(aes((NavWeight),NavError,fill=NumHome))+
  scale_fill_viridis(direction = -1, name="% Home", limits=c(0,100))+
  theme_classic()+
  xlab("WeightNav")+
  ylab("")+
  scale_x_continuous(breaks=seq(0,1,0.2))+
  theme(legend.position = "bottom",
        legend.key.width = unit(2,"cm")))

p1=p.legend+theme(legend.position = "none")

```





# Time integration

Load data and wrangle into a usable format

```{r}
df_TI=read_csv(paste0(directory,"/Time Integration Model timeintegration and errornav-spreadsheet.csv"), col_names = F,skip = 6)

dfTI_clean=clean_nlogo_lastonly_EndRunExport(df_TI,reps = 3,num.variables = 1,
                                  p.max = 50,p.min = 1,p.by = 1,
                      num.things.varied = 3, e.max = 100,e.min=0,e.by = 5,
                      var.names = c("NumHome"),
                      newcolnames = c("TimeIntegrated","NavError","run","coltype"))
```

plot

```{r}
dfTI_clean2=dfTI_clean %>% 
  mutate(NumHome=(NumHome/1000)*100) %>% 
  group_by(run,TimeIntegrated,NavError) %>% 
  summarize(NumHome=max(NumHome)) %>% 
  group_by(TimeIntegrated,NavError) %>% 
  summarize(NumHome=mean(NumHome)) %>% 
   filter(TimeIntegrated<=20 | TimeIntegrated>=50)
   
(p2=ggplot(data=dfTI_clean2)+
  geom_tile(aes(as.factor(TimeIntegrated),NavError,fill=NumHome))+
  scale_fill_viridis(direction = -1,name="% Home")+
  theme_classic()+
  theme(legend.position = "none")+
  xlab("Integration Time (Steps)")+
  ylab("")+
  scale_x_discrete(breaks=c(0,5,10,15,20,50),limits=c("0",paste(seq(1,20,1)),"","50","")))

```



# Localized Sensory System

Load data and wrangle into a usable format

```{r}
df_LS=read_csv("../Models and Code for Publication/Localized Sense Model sizered and errornav-spreadsheet.csv", col_names = F,skip = 6)

dfLS_clean=clean_nlogo_lastonly_EndRunExport(df_LS,reps = 5,num.variables = 1,
                                  p.max = 157,p.min = 0,p.by = 5,
                      num.things.varied = 3, e.max = 100,e.min=0,e.by = 5,
                      var.names = c("NumHome"),
                      newcolnames = c("SizeRed","NavError","run","coltype"))
```

```{r}
#The whole world is 280 by 280patches
xgoal=105
ygoal=42
#Farthest Possible Starting Distance
xstart=175
ystart=186

total.dist=sqrt((xgoal-xstart)^2+(ygoal-ystart)^2)
```


```{r}
(p3=dfLS_clean %>% 
  mutate(NumHome=(NumHome/1000)*100) %>% 
  group_by(run,SizeRed,NavError) %>% 
  summarize(NumHome=max(NumHome)) %>% 
  group_by(SizeRed,NavError) %>% 
  summarize(NumHome=mean(NumHome)) %>% 
  mutate(PercentJourneyRed=(SizeRed/total.dist)*100) %>% 
ggplot()+
  geom_tile(aes((PercentJourneyRed),NavError,fill=NumHome))+
  scale_fill_viridis(direction = -1,name="% Home")+
  theme_classic()+
  theme(legend.position = "none")+
  xlab("% Journey using Perfect Navigation")+
  ylab(""))

#ggsave("C:/Users/jngra/Dropbox (Duke Bio_Ea)/Jesse/Duke/Research/Navigation Orientation/Flocking Model/Localized Sensory System.png",p1)
```


# Combined

All plots together

```{r,fig.width=10, fig.height=3}
library(grid)
library(gridExtra)
library(svglite)

p1.1=p1+
  ylab("Navigational Error (Degrees)     ")+
  #ylab(expression("Less Error " %<->% " More Error     "))+
  xlab(expression("Asocial" %<->% "Flocking"))

pplots1=plot_grid(p1.1,p3+theme(axis.text.y = element_blank(),axis.ticks.y = element_blank()),p2+theme(axis.text.y = element_blank(),axis.ticks.y = element_blank()),nrow=1, labels=c("A","B","C"),align="vh",rel_widths=c(1,1,1))

legend=get_legend(p.legend+
                    theme(legend.position = "right",
        legend.key.width = unit(.5,"cm"))+
          guides(fill = guide_colorbar(reverse=T)))

(pcombined=plot_grid(pplots1,legend,nrow = 1,rel_widths = c(10,1)))

 ggsave("Figure 3_V2.svg",pcombined)
 ggsave("Figure 3_V2.png",pcombined)
```



# Values

```{r}
#The maximum %home when the nav error was 100
df4x_clean %>% 
  group_by(NavWeight,NavError) %>% 
  summarize(NumHome=mean(NumHome)) %>% 
  mutate(NavWeight=1-NavWeight) %>% #1 - Navweight = Flocking Weight 
  filter(NavError==100) %>% 
  ungroup() %>% 
  filter(NumHome==max(NumHome))
##At a flocking weight of 0.8 and a nav error of 100, 72.465% return home

#The minumum size of perfect nav zone where at least 70% return home at nav error = 100
dfLS_clean %>% 
  mutate(NumHome=(NumHome/1000)*100) %>% 
  group_by(run,SizeRed,NavError) %>% 
  summarize(NumHome=max(NumHome)) %>% 
  group_by(SizeRed,NavError) %>% 
  summarize(NumHome=mean(NumHome)) %>% 
  mutate(PercentJourneyRed=(SizeRed/total.dist)*100) %>%
  filter(NavError==100) %>% 
  filter(NumHome>=68)
##at nav error 100, the minimum size red at which ~70% returned home was 115, or 71.8% journey


#Minimum time integration where at least 70% return home at nav error = 100
dfTI_clean %>% 
  mutate(NumHome=(NumHome/1000)*100) %>% 
  group_by(run,TimeIntegrated,NavError) %>% 
  summarize(NumHome=max(NumHome)) %>% 
  group_by(TimeIntegrated,NavError) %>% 
  summarize(NumHome=mean(NumHome)) %>% 
  filter(NavError==100) %>% 
  filter(NumHome>=66)
## At nav error 100, the percent home fluctuates around 67 after time integrated>=43 but never reaches 70
```


