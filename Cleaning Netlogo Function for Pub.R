#Use this if you did not use the end run export only option in behavior space
clean_nlogo=function(df,reps=10,num.variables=2,p.max,p.min,p.by,
                     var.names=c("NumHome","ticks"),
                     newcolnames=c("p","run","coltype"),
                     num.things.varied=2,e.max=1,e.min=0,e.by=0.1,
                     z.max=1,z.min=0,z.by=0.1){
 
  x=which(df == "[all run data]", arr.ind=TRUE) #remove all of the weird header stuff
 #removing the columns headers and col 1 which is all NAs
  df=df %>% 
    slice((x[1]+2):n()) %>% 
    dplyr::select(!X1) 
  
  #how many columns should there be is a multiple of the number of variables recorded
  ##the number of runs, and the number of variables altered
  ##therefore the number of runs is the total number of columns, divided by the num var recorded
  run=rep(seq(from=1,by=1,length.out = ncol(df)/num.variables),each=num.variables)
  coltype=rep(var.names,ncol(df)/num.variables)
  
  #p will vary from min to max, and there should be reps*num.variable columns for each
  if (num.things.varied==2){
    p=rep(seq(p.min,p.max,p.by),each=reps*num.variables)
    p.run=paste(p,run,coltype,sep=",")
    }
  #e will vary from min to max, for each e in the sequence, it will be repeated reps*num.var columns
  ##that chunk of e should then be repeated for the length of the sequence from p.min to p.max 
  #p will vary from p.min to p.max but each p in the sequence will be repeated for the length of e's seq
  ##times the number of reps and vars
  if (num.things.varied == 3) {
    p=rep(seq(p.min,p.max,p.by),each=length(seq(e.min,e.max,e.by))*reps*num.variables)
    e=rep(rep(seq(e.min,e.max,e.by),each=reps*num.variables),length(seq(p.min,p.max,p.by)))
    p.run=paste(p,e,run,coltype,sep=",")
  }
  
  if (num.things.varied == 4) {
    
    p=rep(seq(p.min,p.max,p.by),
          each=length(seq(z.min,z.max,z.by))*length(seq(e.min,e.max,e.by))*reps*num.variables)
    
    e=rep(rep(seq(e.min,e.max,e.by),each=length(seq(z.min,z.max,z.by))*reps*num.variables),
          length(seq(p.min,p.max,p.by)))
    
    z=rep(rep(rep(seq(z.min,z.max,z.by),each=reps*num.variables),length(seq(e.min,e.max,e.by))),
          length(seq(p.min,p.max,p.by)))
    p.run=paste(p,e,z,run,coltype,sep=",")
  }
  
  colnames(df)=p.run
  
  df.1=df %>%
    dplyr::select(contains(var.names[1])) %>% 
    gather("newcols","Var1") %>% 
    separate(newcols, newcolnames, sep=",")%>% 
    dplyr::select(!coltype)
  
  if (num.variables ==3)
  {
    df.2=df %>%
     dplyr::select(contains(var.names[2])) %>% 
      gather("newcols","Var2") %>% 
      separate(newcols, newcolnames, sep=",")%>% 
      dplyr::select(!coltype)
    df.1$Var2=df.2$Var2
  }
  
  df.ticks=df %>% 
    dplyr::select(contains("ticks")) %>% 
    gather("newcols","ticks") %>% 
    separate(newcols, newcolnames, sep=",") 
  
  df.1$ticks=df.ticks$ticks
  
  df.1=df.1 %>% 
    select_all() %>% 
   # mutate(Var2=gsub('^.|.$', '', Var2)) %>% 
    mutate_all(~(as.numeric(.))) %>% 
    drop_na()
  
  df.1.colnames=c(newcolnames[-length(newcolnames)],var.names)
  
  colnames(df.1)=df.1.colnames
  
  df.1
}

#Use this if you did use the end run export only option in behavior space
clean_nlogo_lastonly_EndRunExport=function(df,reps=10,num.variables=2,p.max,p.min,p.by,
                                           var.names=c("NumHome","ticks"),
                                           newcolnames=c("p","run","coltype"),
                                           num.things.varied=2,e.max=1,e.min=0,e.by=0.1,
                                           z.max=1,z.min=0,z.by=0.1){
  
  x=which(df == "[initial & final values]", arr.ind=TRUE) #remove all of the weird header stuff
  #removing the columns headers and col 1 which is all NAs
  df=df %>% 
    slice(x[1] + 1) %>% 
    dplyr::select(!X1) 
  
  #how many columns should there be is a multiple of the number of variables recorded
  ##the number of runs, and the number of variables altered
  ##therefore the number of runs is the total number of columns, divided by the num var recorded
  run=rep(seq(from=1,by=1,length.out = ncol(df)/num.variables),each=num.variables)
  coltype=rep(var.names,ncol(df)/num.variables)
  
  #p will vary from min to max, and there should be reps*num.variable columns for each
  if (num.things.varied==2){
    p=rep(seq(p.min,p.max,p.by),each=reps*num.variables)
    p.run=paste(p,run,coltype,sep=",")
  }
  #e will vary from min to max, for each e in the sequence, it will be repeated reps*num.var columns
  ##that chunk of e should then be repeated for the length of the sequence from p.min to p.max 
  #p will vary from p.min to p.max but each p in the sequence will be repeated for the length of e's seq
  ##times the number of reps and vars
  if (num.things.varied == 3) {
    p=rep(seq(p.min,p.max,p.by),each=length(seq(e.min,e.max,e.by))*reps*num.variables)
    e=rep(rep(seq(e.min,e.max,e.by),each=reps*num.variables),length(seq(p.min,p.max,p.by)))
    p.run=paste(p,e,run,coltype,sep=",")
  }
  
  if (num.things.varied == 4) {
    
    p=rep(seq(p.min,p.max,p.by),
          each=length(seq(z.min,z.max,z.by))*length(seq(e.min,e.max,e.by))*reps*num.variables)
    
    e=rep(rep(seq(e.min,e.max,e.by),each=length(seq(z.min,z.max,z.by))*reps*num.variables),
          length(seq(p.min,p.max,p.by)))
    
    z=rep(rep(rep(seq(z.min,z.max,z.by),each=reps*num.variables),length(seq(e.min,e.max,e.by))),
          length(seq(p.min,p.max,p.by)))
    p.run=paste(p,e,z,run,coltype,sep=",")
  }
  
  colnames(df)=p.run
  
  df.1=df %>%
    dplyr::select(contains(var.names[1])) %>% 
    gather("newcols",!!(var.names[1])) %>% 
    separate(newcols, newcolnames, sep=",")%>% 
    dplyr::select(!coltype) 
  
  
  if (num.variables ==2)
  {
    df.2=df %>%
      dplyr::select(contains(var.names[2])) %>% 
      gather("newcols",!!(var.names[2])) %>% 
      separate(newcols, newcolnames, sep=",")%>% 
      dplyr::select(!coltype)
    df.1=cbind(df.1,df.2[,ncol(df.2)])
  }
  
  df.1=df.1 %>% 
    select_all() %>% 
    # mutate(Var2=gsub('^.|.$', '', Var2)) %>% 
    mutate_all(~(as.numeric(.))) %>% 
    drop_na()
  
  df.1
}




